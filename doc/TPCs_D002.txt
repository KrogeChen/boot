//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
TPCs 0xD002 简易固件升级传输协议。
//-------------------------------------------------------------------------
//报文采用主、从应答方式，需要升级固件的设备为从机设备。
//-------------------------------------------------------------------------
//基本格式
描述:  | 版本 | 命令 | 状态码 | 错误码 | 块序号 | 块内容 | 
长度:  |  1   |   1  |   1    |    1   |   2    |   128  |
//-------------------------------------------------------------------------
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
版本:     0x01 固定值
//-------------------------------------------------------------------------
命令:     0x01(0x81)    查询从机状态  
          0x02(0x82)    进入Boot状态
          0x03(0x83)    重传升级,传输Flie Map内容(文件的头128Byte)
          0x04(0x84)    续传升级,传输Flie Map内容(文件的头128Byte)
          0x05(0x85)    传输File 内容
          
          0xFE          错误报告
          
命令应答: 错误报告采用固定值 0xFE,正常应答采用 [命令值+0x80]。
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
错误码:   0x00          无错误
          0x01          数据长度错误
          0x02          版本不支持
          0x03          命令不支持
          0x04          FileMap checksum错误
          0x05          File checksum错误
          0x06          块序号不匹配
          0x07          固件不匹配
          0xFE          其他未知错误
//---------------------------------------------------------------------------
状态码:   0x00          无效值,填充
          0x01          非Boot状态(需要重启)
          0x10          Boot状态(可以直接升级,无需重启)
          0x11          请求File Map
          0x12          请求File 内容
          0x1F          升级完成          
//----------------------------------------------------------------------------
块序号:从0开始，0块为 File Map。文件内容从块1开始。
//----------------------------------------------------------------------------
块内容: 固定128Byte,不足128Byte,需要采用0xFF或0x00补齐。
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
主机运行流程:
S-->发送命令0x01查询从机状态-->应答错误-->报告错误-->End
                           |-->应答非Boot区-->发送命令0x02进入Boot区-->定期查询是否在Boot区--S.
                           |-->应答在Boot区-->发送重传命令,传输File Map-->根据应答的块序请求号传输File内容-->文件传输完成-->End
                                          |-->发送续传命令,传输File Map-->|                                |
                                                                                                           |-->传输错误-->报告错误号-->End
//----------------------------------------------------------------------------
从机运行流程:
S-->等待主机命令-->0x01命令-->应答0x81，报告当前状态
               |-->0x02命令-->进入Boot状态
               |-->0x03命令-->初始化块序号,从1开开始请求。
               |-->0x04命令-->从当前块序号,开始请求。
               |-->0x05命令-->接收块内容，并生成下一个请求块。如果完毕应答升级完成状态。
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
命令详解
1. 查询从机状态
发送:  | 0x01 | 0x01 |  0x00  | 0x00   |
       | 版本 | 命令 | 状态码 | 错误码 |
应答:  | 0x01 | 0x81 |  0x01  | 0x00   |
       | 版本 | 命令 | 状态码 | 错误码 |非Boot状态
//----------------------------------------------------------------------------
2. 进入Boot状态
发送:  | 0x01 | 0x02 |  0x00  | 0x00   |
       | 版本 | 命令 | 状态码 | 错误码 |
应答:  | 0x01 | 0x82 |  0x00  | 0x00   |
       | 版本 | 命令 | 状态码 | 错误码 |
//----------------------------------------------------------------------------
3. 重传升级
发送:  | 0x01 | 0x03 |  0x00  | 0x00   | 0x00 | 0x00 | 0x03 |....|0x56 |
       | 版本 | 命令 | 状态码 | 错误码 |   块序号    | 128Byte Map数据 |
应答:  | 0x01 | 0x83 |  0x12  | 0x00   | 0x00 | 0x01 |
       | 版本 | 命令 | 状态码 | 错误码 | 请求块序号  |   请求第一个内容块
//----------------------------------------------------------------------------
4. 续传升级
发送:  | 0x01 | 0x04 |  0x00  | 0x00   | 0x00 | 0x00 | 0x03 |....|0x56 |
       | 版本 | 命令 | 状态码 | 错误码 |   块序号    | 128Byte Map数据 |
应答:  | 0x01 | 0x84 |  0x12  | 0x00   | 0x00 | 0x01 |
       | 版本 | 命令 | 状态码 | 错误码 | 请求块序号  |   请求第一个内容块
//----------------------------------------------------------------------------
5. 传输File 内容
发送:  | 0x01 | 0x06 |  0x00  | 0x00   | 0x00 | 0x01 | 0x03 |....|0x56 |
       | 版本 | 命令 | 状态码 | 错误码 |   块序号    | 128Byte 内容数据|
应答:  | 0x01 | 0x86 |  0x12  | 0x00   | 0x00 | 0x02 |
       | 版本 | 命令 | 状态码 | 错误码 | 请求块序号  |    请求一个新块
//----------------------------------------------------------------------------
6. 错误报告
发送:  | 0x02 | 0x01 |  0x00  | 0x00   |
       | 版本 | 命令 | 状态码 | 错误码 |
应答:  | 0x01 | 0xFE |  0x00  | 0x02   |
       | 版本 | 命令 | 状态码 | 错误码 |                  版本不支持报告
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++



